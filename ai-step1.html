<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" href="data:">
<title>Reversi AI step1</title>
<link rel="stylesheet" href="style.css">
</head><body>

<h1>Reversi AI step1</h1>
<main id=main></main>
<div id=divscore></div>
<hr>
<a href=https://github.com/code4fukui/Reversi/>src on GitHub</a>

<script type="module">
import { ReversiBoard } from "./ReversiBoard.js";
import { players, show, waitClick } from "./ui.js";

// https://note.com/nyanyan_cubetech/n/n17c169271832?magazine_key=m54104c8d2f12
const valtbl = [
  [ 30, -12,  0, -1],
  [-12, -15, -3, -3],
  [  0,  -3,  0, -1],
  [ -1,  -3, -1, -1],
];
const getValue = (x, y) => {
  if (x > 3) x = 7 - x;
  if (y > 3) y = 7 - y;
  return valtbl[y][x];
};
const calcValue = (rb, n) => {
  let v = 0;
  const m = 3 - n;
  for (let y = 0; y < 8; y++) {
    for (let x = 0; x < 8; x++) {
      const a = rb.get(x, y);
      if (a == n) {
        v += getValue(x, y);
      } else {
        v -= getValue(x, y);
      }
    }
  }
  return v;
};

const rb = new ReversiBoard();
show(rb);

const ai = 2;
let n = 1;
for (let i = 0; !rb.isOver(); i++) {
  if (!rb.canPut(n)) {
    alert(`${n == ai ? "I" : "You"} must pass!`);
  } else {
    if (n == ai) {
      const hands = rb.getHands(n);
      let max = -1000;
      let maxhand = null;
      for (const hand of hands) {
        const rb2 = new ReversiBoard(rb);
        rb2.put(n, hand.x, hand.y);
        const v = calcValue(rb2, n);
        if (v > max) {
          max = v;
          maxhand = hand;
        }
      }
      rb.put(n, maxhand.x, maxhand.y);
    } else {
      for (;;) {
        const { x, y } = await waitClick();
        if (rb.put(n, x, y)) break;
      }
    }
    show(rb);
    divscore.textContent = rb.getScore().join(" vs ");
  }
  n = 3 - n;
}
const w = rb.getWinner();
if (w == 0) {
  alert("draw game");
} else {
  alert("player " + players[w] + " won!");
}
</script>
</body></html>
